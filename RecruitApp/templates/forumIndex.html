<!doctype html>
<!-- websiteIconPath msgNum problems-->
<html>
<head>
<meta charset="utf-8">
<title>è®ºå›</title>
	{% load static %}
	<link href="{% static 'forum/forumIndex.css' %}" rel="stylesheet" type="text/css">
	<script type="text/javascript" src="{% static 'scripts/jquery-3.2.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'scripts/jquery.cookie.js' %}"></script>
</head>
	
<body>
	<div class="forum_search">
<!--	å…¬å¸å›¾æ ‡	-->
		<div class="forum_search_icon">
			<img src="{{websiteIconPath}}" alt="è®ºå›ç½‘é¡µlogo">
<!--			<img class="forum_search_img" src="../å¥½çœ‹çš„å›¾ç‰‡å“¦/555.jpg">-->
		</div>
<!--	æœç´¢æ¡†	-->
		<div class="forum_search_bar">
			<form method="get" action="/forum/search/">
				<input type="text" name="q" placeholder="æœä¸€æœæ„Ÿå…´è¶£çš„é—®é¢˜..." autocomplete="off">
				<input type="submit" name="submit" value="æœç´¢">
			</form>
		</div>
<!--	æ¶ˆæ¯	-->
		<div class="forum_search_message">
			<a href="/forum/userPage/">æ¶ˆæ¯({{msgNum}})</a>
		</div>
<!--	ç”¨æˆ·å¤´åƒ	-->
		<div class="forum_search_headImg">
			<a href="/forum/userPage/"><img src="{{userHeadIcon}}" alt="ç”¨æˆ·å¤´åƒ"></a>
		</div>
		
	</div>
	
	<div class="forum_question">
<!--	æ ‡é¢˜		-->
		<form method="post" action="/forum/postQuestion/">
			{% csrf_token %}
			<div class="forum_question_title">
				<div class="forum_question_title_type">
					<h3>æé—®é¢˜</h3>
				</div>
				<div class="forum_question_title_word">
					<input type="text" name="title" placeholder="è¯·è¾“å…¥é—®é¢˜æ ‡é¢˜ï¼Œå¿…å¡«" required autocomplete="off">		
				</div>
			</div>
	<!--	å†…å®¹	-->
			<div class="forum_question_content">
				<input type="text" name="content" placeholder="è¯¦ç»†æè¿°ä½ çš„é—®é¢˜å§ï¼Œé€‰å¡«" autocomplete="off">
			</div>
	<!--	å‘å¸ƒ	-->
			<div class="forum_question_release">
				<input type="submit" name="submit" value="å‘å¸ƒ">
			</div>
		</form>
	</div>
	
	<div class="forum_problem"> 
		<ul>
			{% for problem in problems %}
			<li>
				<div class="forum_problem_title">
			<!--	æ ‡é¢˜	-->
					<div class="forum_problem_title_word">
						<h3><a href="/forum/question/{{problem.id}}">{{problem.title}}</a></h3>

					</div>
			<!--	é˜…è¯»é‡	-->
					<div class="forum_problem_title_read">
						é˜…è¯»ï¼š{{problem.readCount}}
					</div>
			<!--	å›ç­”é‡	-->
					<div class="forum_problem_title_answer">
						å›ç­”é‡ï¼š{{problem.answerCount}}
					</div>
				</div>
				
				{% if problem.bestAnswer %}
				<div class="forum_problem_user">
					
					<div class="forum_problem_user_headImg">
						<img src="/static/{{ problem.author.perinfo.perHeadPath }}">
					</div>
					<div class="forum_problem_user_name">
						<div>
							{{ problem.bestAnswer.author.perinfo.perName }}
						</div>
					</div>

				</div>
				
				<div class="forum_problem_content">
					{{ problem.bestAnswer.content }}
				</div>
				
				<div class="forum_problem_time">
					åˆ›å»ºæ—¥æœŸ : {{ problem.bestAnswer.createTime }}
				</div>
				
				<div class="forum_problem_like">
					<!-- åˆ¤æ–­æ˜¯å¦å·²ç»èµè¿‡ -->
					{% if problem.bestAnswer.isLiked %}
					<div class="forum_problem_like_like">
						ğŸ‘<button id="like_btn" onclick="likeClick({{problem.bestAnswer.id}})">å–æ¶ˆèµ</button><div id="like_num">({{problem.bestAnswer.likeCount}})</div>
					</div>
					{% else %}
					<div class="forum_problem_like_like">
						ğŸ‘<button id='like_btn' onclick="likeClick({{problem.bestAnswer.id}})">èµ</button><div id="like_num">({{problem.bestAnswer.likeCount}})</div>
					</div>
					{% endif %}
					<div class="forum_problem_like_comment">
					</div>
				</div>
				{% else %}
				<div class="forum_problem_user">
					<div>
						æš‚æ— å›ç­”
					</div>
				</div>
				{% endif %}
			</li>
			{% endfor %}
		</ul>
	</div>
</body>
</html>


<script>

function likeClick(answerId){
	$.ajax({
		async: true,
		url: "/forum/like/" + answerId,
		type: "get",
		headers:{"X-CSRFToken":$.cookie("csrftoken")},
		// beforeSend: function(){
		// 	$("#unique_msg").html("loading");
		// },
		success:function(data){
			var datas = data.split(';');
			var likeOrCancel = datas[0];
			var likeNum = datas[1];
			if(likeOrCancel == 'True'){
				$('#like_btn').html('å–æ¶ˆèµ');
			}
			else{
				$('#like_btn').html('èµ');
			}
			$('#like_num').html('(' + likeNum + ')');
		}
	});

}

</script>
